<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>XGPU Pro</title>
  
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: { extend: { colors: { slate: { 950: '#020617' } } } }
    }
  </script>

  <!-- React & ReactDOM -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <!-- Babel (Compiles React in the browser) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <!-- Firebase Compat Libraries -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
</head>
<body class="bg-slate-950 text-slate-300 font-sans p-4 md:p-8 min-h-screen">
  
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // ==========================================
    // --- YOUR FIREBASE CONFIG ---
    // ==========================================
    const firebaseConfig = {
      apiKey: "AIzaSyAFi2cC2TZfRSIlPzHGcrkw51ChSmcS_64",
      authDomain: "xgpu-pro.firebaseapp.com",
      projectId: "xgpu-pro",
      storageBucket: "xgpu-pro.firebasestorage.app",
      messagingSenderId: "940027104740",
      appId: "1:940027104740:web:702e50f4171cf420644bf1"
    };
    // ==========================================

    const isConfigValid = firebaseConfig.apiKey && firebaseConfig.apiKey !== "PASTE_YOUR_API_KEY_HERE";
    const appId = "xgpu-pro";

    // Initialize Firebase conditionally to prevent crash on invalid API key
    let auth = null;
    let db = null;
    
    if (isConfigValid) {
      if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
      }
      auth = firebase.auth();
      db = firebase.firestore();
    }

    // --- SVGs for Icons ---
    const ShieldCheck = ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/><path d="m9 12 2 2 4-4"/></svg>;
    const Database = ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M3 5V19A9 3 0 0 0 21 19V5"/><path d="M3 12A9 3 0 0 0 21 12"/></svg>;
    const RefreshCw = ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/><path d="M3 3v5h5"/></svg>;
    const AlertCircle = ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><circle cx="12" cy="12" r="10"/><line x1="12" x2="12" y1="8" y2="12"/><line x1="12" x2="12.01" y1="16" y2="16"/></svg>;
    const FileText = ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><line x1="10" y1="9" x2="8" y2="9"/></svg>;
    const UploadIcon = ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" x2="12" y1="3" y2="15"/></svg>;
    const Play = ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polygon points="5 3 19 12 5 21 5 3"/></svg>;
    const Check = ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="20 6 9 17 4 12"/></svg>;
    const Copy = ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>;
    const DownloadIcon = ({size=24, className=""}) => <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" x2="12" y1="15" y2="3"/></svg>;

    function App() {
      const [user, setUser] = useState(null);
      const [dbCombos, setDbCombos] = useState(new Set());
      const [isLoadingDb, setIsLoadingDb] = useState(true);
      
      const [inputText, setInputText] = useState('');
      const [resultText, setResultText] = useState('');
      const [isProcessing, setIsProcessing] = useState(false);
      const [copied, setCopied] = useState(false);
      const [error, setError] = useState('');

      const [stats, setStats] = useState({
        processed: 0, duplicates: 0, added: 0
      });

      const fileInputRef = useRef(null);

      useEffect(() => {
        if (!isConfigValid || !auth) {
          setError("Database connection disabled: Please edit the index.html file in GitHub and paste your valid Firebase Config.");
          setIsLoadingDb(false);
          return;
        }

        auth.signInAnonymously().catch(err => {
          console.error("Auth error:", err);
          setError("Authentication failed. Ensure Anonymous sign-in is enabled in Firebase.");
          setIsLoadingDb(false);
        });

        const unsubscribe = auth.onAuthStateChanged((currentUser) => {
          setUser(currentUser);
        });

        return () => unsubscribe();
      }, []);

      useEffect(() => {
        if (!user || !db || !isConfigValid) return;

        const loadDatabase = async () => {
          setIsLoadingDb(true);
          try {
            const combosRef = db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('combos');
            const snapshot = await combosRef.get();
            
            const combos = new Set();
            snapshot.forEach(doc => combos.add(doc.data().combo));
            setDbCombos(combos);
          } catch (err) {
            console.error("Failed to load db", err);
            setError("Failed to connect to secure storage. Make sure Firestore is created and rules allow reading.");
          } finally {
            setIsLoadingDb(false);
          }
        };

        loadDatabase();
      }, [user]);

      const handleProcess = async () => {
        if (!inputText.trim()) {
          setError("Please paste some combos or upload a file first.");
          setTimeout(() => setError(''), 3000);
          return;
        }
        
        if (!isConfigValid) {
          setError("Please paste your valid Firebase Config into the code to use this feature.");
          return;
        }

        if (!user) {
          setError("Waiting for authentication...");
          return;
        }

        setIsProcessing(true);
        setError('');

        try {
          const lines = inputText.split(/\r?\n/).map(l => l.trim()).filter(l => l);
          
          const valid = lines.map(l => {
            const parts = l.split(':');
            if (parts.length >= 2 && parts[0].includes('@')) {
               return `${parts[0].trim()}:${parts[1].trim()}`;
            }
            return null;
          }).filter(Boolean);

          const newCombos = [];
          const newSet = new Set(); 

          for (const combo of valid) {
            if (!dbCombos.has(combo) && !newSet.has(combo)) {
              newCombos.push(combo);
              newSet.add(combo);
            }
          }

          if (newCombos.length > 0) {
            const combosRef = db.collection('artifacts').doc(appId).collection('users').doc(user.uid).collection('combos');
            const batches = [];
            let batch = db.batch();
            let count = 0;

            for (const combo of newCombos) {
              const docRef = combosRef.doc();
              batch.set(docRef, { combo, addedAt: Date.now() });
              count++;
              
              if (count === 450) {
                batches.push(batch);
                batch = db.batch();
                count = 0;
              }
            }
            if (count > 0) batches.push(batch);

            for (const b of batches) {
              await b.commit();
            }

            const updatedDbCombos = new Set(dbCombos);
            newCombos.forEach(c => updatedDbCombos.add(c));
            setDbCombos(updatedDbCombos);
          }

          setStats({
            processed: valid.length,
            duplicates: valid.length - newCombos.length,
            added: newCombos.length
          });
          setResultText(newCombos.join('\n'));

        } catch (err) {
          console.error(err);
          setError("An error occurred while processing: " + err.message);
        } finally {
          setIsProcessing(false);
        }
      };

      const handleFileUpload = (e) => {
        const file = e.target.files[0];
        if (!file) return;
        const reader = new FileReader();
        reader.onload = (event) => setInputText(event.target.result);
        reader.readAsText(file);
        e.target.value = null; 
      };

      const copyToClipboard = () => {
        if (!resultText) return;
        const textArea = document.createElement("textarea");
        textArea.value = resultText;
        document.body.appendChild(textArea);
        textArea.select();
        try {
          document.execCommand('copy');
          setCopied(true);
          setTimeout(() => setCopied(false), 2000);
        } catch (err) { console.error('Copy failed', err); }
        document.body.removeChild(textArea);
      };

      const downloadResults = () => {
        if (!resultText) return;
        const blob = new Blob([resultText], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `XGPU_Pro_Unique_${new Date().toISOString().slice(0, 10)}.txt`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      };

      return (
        <div className="max-w-6xl mx-auto space-y-6">
          <header className="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 border-b border-slate-800 pb-6">
            <div className="flex items-center gap-3">
              <div className="p-3 bg-green-500/10 text-green-500 rounded-xl">
                <ShieldCheck size={28} />
              </div>
              <div>
                <h1 className="text-2xl font-extrabold text-green-500 tracking-tight">XGPU Pro</h1>
                <p className="text-sm text-slate-500">Advanced Deduplication & Secure Master Storage</p>
              </div>
            </div>

            <div className="flex items-center gap-4 bg-slate-900 px-6 py-3 rounded-xl border border-slate-800 shadow-inner">
              <div className="flex flex-col">
                <span className="text-xs text-slate-500 uppercase tracking-wider font-semibold">Master List</span>
                <div className="flex items-center gap-2">
                  <Database size={16} className="text-green-500" />
                  {isLoadingDb ? (
                    <span className="text-slate-400 flex items-center gap-2 text-sm font-medium">
                      <RefreshCw size={14} className={isLoadingDb && isConfigValid ? "animate-spin" : ""} /> Syncing...
                    </span>
                  ) : (
                    <span className="text-xl font-bold text-slate-100">{dbCombos.size.toLocaleString()} <span className="text-sm font-normal text-slate-500">combos</span></span>
                  )}
                </div>
              </div>
            </div>
          </header>

          {error && (
            <div className="bg-rose-500/10 border border-rose-500/20 text-rose-400 px-4 py-3 rounded-lg flex items-center gap-3">
              <AlertCircle size={18} />
              <span className="text-sm font-medium">{error}</span>
            </div>
          )}

          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div className="space-y-4">
              <div className="flex items-center justify-between">
                <h2 className="text-lg font-semibold text-slate-200 flex items-center gap-2">
                  <FileText size={18} className="text-green-500" /> Input Data
                </h2>
                <div className="flex gap-2">
                  <input type="file" accept=".txt" ref={fileInputRef} onChange={handleFileUpload} className="hidden" />
                  <button onClick={() => fileInputRef.current?.click()} className="text-xs flex items-center gap-1.5 px-3 py-1.5 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg transition-colors border border-slate-700">
                    <UploadIcon size={14} /> Upload .txt
                  </button>
                  <button onClick={() => setInputText('')} className="text-xs px-3 py-1.5 hover:bg-slate-800 text-slate-400 rounded-lg transition-colors">
                    Clear
                  </button>
                </div>
              </div>
              
              <textarea
                value={inputText}
                onChange={(e) => setInputText(e.target.value)}
                placeholder="Paste your new mail:pass list here...&#10;example@email.com:password123&#10;user@domain.com:securepass!"
                className="w-full h-80 bg-slate-900 border border-slate-800 rounded-xl p-4 text-sm font-mono text-slate-300 focus:outline-none focus:border-green-500/50 focus:ring-1 focus:ring-green-500/50 resize-none shadow-inner"
              />

              <button
                onClick={handleProcess}
                disabled={isProcessing || isLoadingDb || !isConfigValid}
                className={`w-full py-4 rounded-xl font-bold flex items-center justify-center gap-2 transition-all shadow-lg
                  ${isProcessing || isLoadingDb || !isConfigValid ? 'bg-slate-800 text-slate-500 cursor-not-allowed' : 'bg-green-600 hover:bg-green-500 text-white shadow-green-500/20'}`}
              >
                {isProcessing ? (
                  <><RefreshCw size={20} className="animate-spin" /> Processing & Saving to Master...</>
                ) : (
                  <><Play size={20} /> Sort & Auto-Save New</>
                )}
              </button>
            </div>

            <div className="space-y-4">
              <div className="flex items-center justify-between">
                <h2 className="text-lg font-semibold text-slate-200 flex items-center gap-2">
                  <Check size={18} className="text-green-500" /> Unique Results
                </h2>
                <div className="flex gap-2">
                  <button onClick={copyToClipboard} disabled={!resultText} className="text-xs flex items-center gap-1.5 px-3 py-1.5 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg transition-colors border border-slate-700 disabled:opacity-50">
                    {copied ? <Check size={14} className="text-green-500" /> : <Copy size={14} />} 
                    {copied ? 'Copied!' : 'Copy'}
                  </button>
                  <button onClick={downloadResults} disabled={!resultText} className="text-xs flex items-center gap-1.5 px-3 py-1.5 bg-slate-800 hover:bg-slate-700 text-slate-300 rounded-lg transition-colors border border-slate-700 disabled:opacity-50">
                    <DownloadIcon size={14} /> Save .txt
                  </button>
                </div>
              </div>

              <textarea
                readOnly
                value={resultText}
                placeholder="100% unique results will appear here after checking against your Master List..."
                className="w-full h-80 bg-slate-900/50 border border-slate-800 rounded-xl p-4 text-sm font-mono text-green-400 focus:outline-none resize-none shadow-inner"
              />

              <div className="grid grid-cols-1 sm:grid-cols-3 gap-4">
                <div className="bg-slate-900 border border-slate-800 p-4 rounded-xl shadow-sm">
                  <div className="text-xs text-slate-500 mb-1 font-semibold uppercase tracking-wide">Processed</div>
                  <div className="text-xl font-bold text-slate-200">{stats.processed.toLocaleString()}</div>
                </div>
                <div className="bg-slate-900 border border-slate-800 p-4 rounded-xl shadow-sm">
                  <div className="text-xs text-rose-400/70 mb-1 font-semibold uppercase tracking-wide">Duplicates</div>
                  <div className="text-xl font-bold text-rose-400">{stats.duplicates.toLocaleString()}</div>
                </div>
                <div className="bg-green-900/20 border border-green-500/20 p-4 rounded-xl relative overflow-hidden shadow-sm">
                  <div className="text-xs text-green-400/70 mb-1 font-semibold uppercase tracking-wide">New (Auto-Saved)</div>
                  <div className="text-xl font-bold text-green-400">{stats.added.toLocaleString()}</div>
                  {stats.added > 0 && (
                    <div className="absolute top-2 right-2 text-green-500/20">
                      <Database size={32} />
                    </div>
                  )}
                </div>
              </div>

            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
